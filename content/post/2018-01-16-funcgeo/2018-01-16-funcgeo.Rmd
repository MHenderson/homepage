---
title: "Functional Geometry in R"
author: "Matthew Henderson"
date: 2018-01-17T21:13:14+00:00
categories: ["R"]
tags: ["R Markdown", "plot", "regression"]
bibliography: [funcgeo.bib]
twitterImg: /post/2018-01-16-funcgeo_files/figure-html/squarelimit2-1.png
description: "Draw Escher's Square Limit in R"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  fig.height = 3,
  fig.width = 3
)
```

This post introduces
**funcgeo**,
an R package
for functional geometry,
by recreating Square Limit
by M. Escher
(Fig. 1)
following the approach of
@Henderson:1982:FG.

```{r squarelimit, echo = FALSE, fig.width = 5, fig.height = 5, fig.cap = "Square Limit"}
library(funcgeo)
library(grid)

nil <- nullGrob()
t <- quartet(fish_p, fish_q, fish_r, fish_s)
u <- cycle(rot(fish_q))

side1 <- quartet(nil, nil, rot(t), t)
side2 <- quartet(side1, side1, rot(t), t)

corner1 <- quartet(nil, nil, nil, u)
corner2 <- quartet(corner1, side1, rot(side1), u)

corner <- nonet(
  corner2, side2, side2,
  rot(side2), u, rot(t),
  rot(side2), rot(t), rot(fish_q)
)

squarelimit <- cycle(corner)
plot(squarelimit)
```

Peter Henderson describes
Functional Geometry in two papers:
@Henderson:1982:FG
and
@Henderson:2002:FG.
In those papers
he shows
how to define
a language of pictures
using basic concepts
of functional programming.

[**funcgeo**](https://mhenderson.github.io/funcgeo/)
implements a picture language
like the one described in
@Henderson:1982:FG.

To install
**funcgeo**
use `install_gitlab` from
the **remotes** package.

```{r, eval = FALSE}
#install.packages("remotes")
remotes::install_gitlab("MHenderson1/funcgeo")
```

The next section
introduces the basic fish pictures
used to construct Square Limit.

After that,
in subsequent sections,
the fish
are combined into
more complex pictures
where the lines of the fish
are connected
at picture boundaries.
The penultimate step
before constructing
the complete Square Limit picture
is to combine the complex pictures
into the sides
and corners
of Square Limit.

# Fish

The fish from
@Henderson:1982:FG
are available in **funcgeo**
as package data:
`fish_p`,
`fish_q`,
`fish_r`
and
`fish_s`.
All fish
have class `picture`
and **funcgeo** implements
a `plot` method for
`picture`s.

```{r p, fig.width = 2, fig.height = 2, fig.cap = "Fish P"}
library(funcgeo)
library(magrittr)
library(RColorBrewer)

palette <- brewer.pal(4, "Set2")

fish_p %<>% editGrob(gp = gpar(col = palette[1]))
fish_r %<>% editGrob(gp = gpar(col = palette[2]))
fish_s %<>% editGrob(gp = gpar(col = palette[3]))

plot(fish_p)
```

```{r q, fig.width = 2, fig.height = 2, fig.cap = "Fish Q"}
fish_q %<>% editGrob(gp = gpar(col = palette[4]))

plot(fish_q)
```

# Combining fish

Picture operations from
@Henderson:1982:FG
like `rot`, `flip`
and `cycle`
are implemented in **funcgeo**.

For example,
the `quartet` operation
described in @Henderson:1982:FG
is used to combine
the four fish
into `t`,
one of the building blocks
of Square Limit.

```{r t, fig.cap = "t"}
t <- quartet(fish_p, fish_q, fish_r, fish_s)
plot(t)
```

Similarly,
`cycle`
and `rot`
functions
are used to create
`u` from `fish_q`.

```{r u, fig.cap = "u"}
u <- cycle(rot(fish_q))
plot(u)
```

# Sides

`quartet`
is also required
for building `side1`,
one of the more complex
pieces of Square Limit.
`side1` also requires
the `rot` operation
and `nil` empty picture.

```{r side1, fig.cap = "Side 1"}
side1 <- quartet(nil, nil, rot(t), t)
plot(side1)
```

`side2` is created
as a `quartet`
involving several pictures,
including `side1`.

```{r side2, fig.cap = "Side 2"}
side2 <- quartet(side1, side1, rot(t), t)
plot(side2)
```

# Corners

The goal
of this section
is to reproduce
`corner` from
@Henderson:1982:FG.
Square Limit is created
by calling the `cycle` operation
on `corner`.
However,
creating `corner`
requires first creating
`corner2`,
which itself is based
on `corner1`
which is a `quartet`
of three null pictures
and `u`.

```{r corner1, fig.cap = "Corner 1"}
corner1 <- quartet(nil, nil, nil, u)
plot(corner1)
```

`corner2` is also
a `quartet`
made from `corner1`
`side1`
and `u`.

```{r corner2, fig.cap = "Corner 2"}
corner2 <- quartet(corner1, side1, rot(side1), u)
plot(corner2)
```

`nonet` is a 
$3 \times 3$
equivalent of `quartet`
and is used
with `corner2`
`side2`,
`u`,
`t`,
and `fish_q`
to create `corner`,
the only picture
we need to create
Square Limit.

```{r corner, fig.cap = "Corner"}
corner <- nonet(
  corner2, side2, side2,
  rot(side2), u, rot(t),
  rot(side2), rot(t), rot(fish_q)
)
plot(corner)
```

# Square Limit

Square Limit now is
just `cycle`
with `corner`.

```{r squarelimit2, fig.width = 5, fig.height = 5, fig.cap = "Square Limit"}
squarelimit <- cycle(corner)
plot(squarelimit)
```

